<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dynamic Blog - Firebase Powered</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 10px;
            font-weight: 500;
        }

        .status-connected {
            background: rgba(72, 187, 120, 0.2);
            color: #38a169;
            border: 2px solid rgba(72, 187, 120, 0.3);
        }

        .status-disconnected {
            background: rgba(245, 101, 101, 0.2);
            color: #e53e3e;
            border: 2px solid rgba(245, 101, 101, 0.3);
        }

        .status-loading {
            background: rgba(237, 137, 54, 0.2);
            color: #dd6b20;
            border: 2px solid rgba(237, 137, 54, 0.3);
        }

        .toggle-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .toggle-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .admin-panel, .blog-view {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-right: 10px;
            position: relative;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f56565, #e53e3e);
        }

        .btn-danger:hover {
            box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3);
        }

        .blog-post {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .blog-post:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .blog-post h2 {
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .blog-meta {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .blog-category {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .blog-content {
            color: #4a5568;
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .btn-edit {
            background: linear-gradient(45deg, #4299e1, #3182ce);
        }

        .btn-edit:hover {
            box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3);
        }

        .edit-form {
            background: rgba(249, 250, 251, 0.8);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            animation: fadeIn 0.3s ease-in;
        }

        .edit-form h3 {
            color: #2d3748;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .edit-controls {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .no-posts, .loading {
            text-align: center;
            color: #718096;
            font-style: italic;
            padding: 3rem;
        }

        .search-bar {
            margin-bottom: 2rem;
        }

        .search-bar input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }

        .category-filter {
            margin-bottom: 2rem;
        }

        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .category-tag {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #e2e8f0;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-tag:hover,
        .category-tag.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .error-message {
            background: rgba(245, 101, 101, 0.1);
            border: 2px solid rgba(245, 101, 101, 0.3);
            color: #e53e3e;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .blog-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Firebase Blog</h1>
            <p>Real-time blog powered by Firebase</p>
            <div id="connectionStatus" class="status-indicator status-loading">
                <div class="spinner"></div>
                Connecting to Firebase...
            </div>
            <button class="toggle-btn" onclick="toggleView()" id="toggleBtn" disabled>üîÑ Switch to Admin</button>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel hidden">
            <h2>üìù Create New Blog Post</h2>
            <div id="errorMessage"></div>
            <form id="blogForm">
                <div class="form-group">
                    <label for="title">Post Title:</label>
                    <input type="text" id="title" name="title" required placeholder="Enter your blog title...">
                </div>
                
                <div class="form-group">
                    <label for="author">Author:</label>
                    <input type="text" id="author" name="author" required placeholder="Your name...">
                </div>
                
                <div class="form-group">
                    <label for="category">Category:</label>
                    <select id="category" name="category" required>
                        <option value="">Select a category...</option>
                        <option value="Technology">Technology</option>
                        <option value="Lifestyle">Lifestyle</option>
                        <option value="Travel">Travel</option>
                        <option value="Food">Food</option>
                        <option value="Business">Business</option>
                        <option value="Health">Health</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="content">Content:</label>
                    <textarea id="content" name="content" required placeholder="Write your blog content here..."></textarea>
                </div>
                
                <button type="submit" class="btn" id="publishBtn">üöÄ Publish Post</button>
                <button type="button" class="btn btn-danger" onclick="clearForm()">üóëÔ∏è Clear Form</button>
            </form>
        </div>

        <!-- Blog View -->
        <div id="blogView" class="blog-view">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="üîç Search blog posts..." onkeyup="searchPosts()">
            </div>
            
            <div class="category-filter">
                <label><strong>Filter by Category:</strong></label>
                <div class="category-tags" id="categoryTags">
                    <span class="category-tag active" onclick="filterByCategory('all')">All Posts</span>
                </div>
            </div>
            
            <div id="blogPosts">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading posts from Firebase...
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getDatabase, 
            ref, 
            push, 
            onValue, 
            remove,
            update,
            serverTimestamp,
            off
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBTw1w1OGpGch6gnRaSs7wslq5blxQvd_g",
            authDomain: "astroakshat-3151a.firebaseapp.com",
            databaseURL: "https://astroakshat-3151a-default-rtdb.firebaseio.com/",
            projectId: "astroakshat-3151a",
            storageBucket: "astroakshat-3151a.firebasestorage.app",
            messagingSenderId: "902505541622",
            appId: "1:902505541622:web:f5364ab72fb11ece6e61d7",
            measurementId: "G-6GLS1CS0RF"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Global variables
        let isAdminMode = false;
        let posts = [];
        let currentFilter = 'all';
        let isConnected = false;
        let editingPost = null;

        // Update connection status
        function updateConnectionStatus(connected, error = null) {
            const statusEl = document.getElementById('connectionStatus');
            const toggleBtn = document.getElementById('toggleBtn');
            
            if (error) {
                statusEl.className = 'status-indicator status-disconnected';
                statusEl.innerHTML = '‚ùå Connection Error';
                toggleBtn.disabled = true;
                showError(`Firebase connection error: ${error.message}`);
            } else if (connected) {
                statusEl.className = 'status-indicator status-connected';
                statusEl.innerHTML = '‚úÖ Connected to Firebase';
                toggleBtn.disabled = false;
                isConnected = true;
                hideError();
            } else {
                statusEl.className = 'status-indicator status-loading';
                statusEl.innerHTML = '<div class="spinner"></div>Connecting...';
                toggleBtn.disabled = true;
            }
        }

        // Error handling
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.innerHTML = `<div class="error-message">${message}</div>`;
        }

        function hideError() {
            const errorEl = document.getElementById('errorMessage');
            errorEl.innerHTML = '';
        }

        // Initialize Firebase connection and load posts
        function initializeBlog() {
            const postsRef = ref(database, 'blogPosts');
            
            onValue(postsRef, (snapshot) => {
                updateConnectionStatus(true);
                
                const data = snapshot.val();
                posts = [];
                
                if (data) {
                    Object.keys(data).forEach(key => {
                        posts.push({
                            id: key,
                            ...data[key]
                        });
                    });
                    
                    // Sort posts by timestamp (newest first)
                    posts.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                }
                
                updateCategoryTags();
                displayPosts();
            }, (error) => {
                updateConnectionStatus(false, error);
                console.error('Firebase connection error:', error);
            });
        }

        // Toggle between admin and blog view
        window.toggleView = function() {
            if (!isConnected) return;
            
            // Cancel any active edits when switching views
            if (editingPost) {
                cancelEdit(editingPost);
            }
            
            const adminPanel = document.getElementById('adminPanel');
            const blogView = document.getElementById('blogView');
            const toggleBtn = document.getElementById('toggleBtn');
            
            isAdminMode = !isAdminMode;
            
            if (isAdminMode) {
                adminPanel.classList.remove('hidden');
                blogView.classList.add('hidden');
                toggleBtn.textContent = 'üëÅÔ∏è Switch to Blog View';
            } else {
                adminPanel.classList.add('hidden');
                blogView.classList.remove('hidden');
                toggleBtn.textContent = '‚úèÔ∏è Switch to Admin';
            }
            
            // Refresh the display to show/hide admin controls
            displayPosts();
        };

        // Handle form submission
        document.getElementById('blogForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!isConnected) {
                showError('Not connected to Firebase. Please wait for connection.');
                return;
            }
            
            const publishBtn = document.getElementById('publishBtn');
            const originalText = publishBtn.innerHTML;
            
            // Show loading state
            publishBtn.disabled = true;
            publishBtn.innerHTML = '<div class="spinner"></div>Publishing...';
            
            try {
                const formData = new FormData(e.target);
                const newPost = {
                    title: formData.get('title'),
                    author: formData.get('author'),
                    category: formData.get('category'),
                    content: formData.get('content'),
                    timestamp: serverTimestamp(),
                    dateCreated: new Date().toISOString()
                };
                
                const postsRef = ref(database, 'blogPosts');
                await push(postsRef, newPost);
                
                clearForm();
                hideError();
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.className = 'error-message';
                successMsg.style.background = 'rgba(72, 187, 120, 0.1)';
                successMsg.style.borderColor = 'rgba(72, 187, 120, 0.3)';
                successMsg.style.color = '#38a169';
                successMsg.textContent = '‚úÖ Blog post published successfully!';
                
                document.getElementById('errorMessage').appendChild(successMsg);
                setTimeout(() => successMsg.remove(), 3000);
                
            } catch (error) {
                console.error('Error publishing post:', error);
                showError(`Failed to publish post: ${error.message}`);
            } finally {
                publishBtn.disabled = false;
                publishBtn.innerHTML = originalText;
            }
        });

        // Clear form
        window.clearForm = function() {
            document.getElementById('blogForm').reset();
            hideError();
        };

        // Display all posts
        function displayPosts() {
            const container = document.getElementById('blogPosts');
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="no-posts">
                        <h3>üìù No blog posts yet!</h3>
                        <p>Switch to admin mode to create your first post.</p>
                    </div>
                `;
                return;
            }

            let filteredPosts = posts;
            if (currentFilter !== 'all') {
                filteredPosts = posts.filter(post => post.category === currentFilter);
            }

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm) {
                filteredPosts = filteredPosts.filter(post =>
                    post.title.toLowerCase().includes(searchTerm) ||
                    post.content.toLowerCase().includes(searchTerm) ||
                    post.author.toLowerCase().includes(searchTerm)
                );
            }

            if (filteredPosts.length === 0) {
                container.innerHTML = `
                    <div class="no-posts">
                        <h3>üîç No posts found</h3>
                        <p>Try adjusting your search or filter criteria.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredPosts.map(post => {
                const postDate = post.dateCreated ? 
                    new Date(post.dateCreated).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    }) : 'Unknown date';
                
                const postTime = post.dateCreated ? 
                    new Date(post.dateCreated).toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : '';

                return `
                    <div class="blog-post fade-in">
                        <h2>${post.title}</h2>
                        <div class="blog-meta">
                            <span>üë§ By ${post.author}</span>
                            <span>üìÖ ${postDate}</span>
                            ${postTime ? `<span>üïí ${postTime}</span>` : ''}
                            <span class="blog-category">${post.category}</span>
                        </div>
                        <div class="blog-content">${post.content.replace(/\n/g, '<br>')}</div>
                        ${isAdminMode ? `
                            <div class="admin-controls">
                                <button class="btn btn-edit" onclick="editPost('${post.id}')">‚úèÔ∏è Edit</button>
                                <button class="btn btn-danger" onclick="deletePost('${post.id}')">üóëÔ∏è Delete</button>
                            </div>
                            <div id="edit-form-${post.id}" class="edit-form hidden">
                                <h3>‚úèÔ∏è Edit Post</h3>
                                <form onsubmit="updatePost(event, '${post.id}')">
                                    <div class="form-group">
                                        <label>Title:</label>
                                        <input type="text" name="title" value="${post.title.replace(/"/g, '&quot;')}" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Author:</label>
                                        <input type="text" name="author" value="${post.author.replace(/"/g, '&quot;')}" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Category:</label>
                                        <select name="category" required>
                                            <option value="Technology" ${post.category === 'Technology' ? 'selected' : ''}>Technology</option>
                                            <option value="Lifestyle" ${post.category === 'Lifestyle' ? 'selected' : ''}>Lifestyle</option>
                                            <option value="Travel" ${post.category === 'Travel' ? 'selected' : ''}>Travel</option>
                                            <option value="Food" ${post.category === 'Food' ? 'selected' : ''}>Food</option>
                                            <option value="Business" ${post.category === 'Business' ? 'selected' : ''}>Business</option>
                                            <option value="Health" ${post.category === 'Health' ? 'selected' : ''}>Health</option>
                                            <option value="Other" ${post.category === 'Other' ? 'selected' : ''}>Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Content:</label>
                                        <textarea name="content" required rows="6">${post.content}</textarea>
                                    </div>
                                    <div class="edit-controls">
                                        <button type="submit" class="btn">üíæ Save Changes</button>
                                        <button type="button" class="btn btn-danger" onclick="cancelEdit('${post.id}')">‚ùå Cancel</button>
                                    </div>
                                </form>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        // Delete post
        window.deletePost = async function(id) {
            if (!confirm('Are you sure you want to delete this post? This action cannot be undone.')) return;
            
            try {
                // Hide edit form if it's open for this post
                if (editingPost === id) {
                    cancelEdit(id);
                }
                
                const postRef = ref(database, `blogPosts/${id}`);
                await remove(postRef);
                
                // Show success message
                showSuccessMessage('Post deleted successfully!');
            } catch (error) {
                console.error('Error deleting post:', error);
                showError(`Failed to delete post: ${error.message}`);
            }
        };

        // Edit post
        window.editPost = function(id) {
            // Close any other edit forms first
            if (editingPost && editingPost !== id) {
                cancelEdit(editingPost);
            }
            
            const editForm = document.getElementById(`edit-form-${id}`);
            if (editForm) {
                editForm.classList.remove('hidden');
                editingPost = id;
                
                // Scroll to the edit form
                editForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        };

        // Cancel edit
        window.cancelEdit = function(id) {
            const editForm = document.getElementById(`edit-form-${id}`);
            if (editForm) {
                editForm.classList.add('hidden');
                if (editingPost === id) {
                    editingPost = null;
                }
            }
        };

        // Update post
        window.updatePost = async function(event, id) {
            event.preventDefault();
            
            if (!isConnected) {
                showError('Not connected to Firebase. Please wait for connection.');
                return;
            }
            
            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner"></div>Saving...';
            
            try {
                const formData = new FormData(form);
                const updatedPost = {
                    title: formData.get('title'),
                    author: formData.get('author'),
                    category: formData.get('category'),
                    content: formData.get('content'),
                    lastModified: serverTimestamp()
                };
                
                const postRef = ref(database, `blogPosts/${id}`);
                await update(postRef, updatedPost);
                
                // Hide edit form
                cancelEdit(id);
                hideError();
                
                // Show success message
                showSuccessMessage('Post updated successfully!');
                
            } catch (error) {
                console.error('Error updating post:', error);
                showError(`Failed to update post: ${error.message}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        };

        // Show success message
        function showSuccessMessage(message) {
            const successMsg = document.createElement('div');
            successMsg.className = 'error-message';
            successMsg.style.background = 'rgba(72, 187, 120, 0.1)';
            successMsg.style.borderColor = 'rgba(72, 187, 120, 0.3)';
            successMsg.style.color = '#38a169';
            successMsg.textContent = `‚úÖ ${message}`;
            
            // Add to blog view if visible, otherwise to admin panel
            const targetContainer = isAdminMode ? 
                document.getElementById('errorMessage') : 
                document.getElementById('blogView');
                
            if (targetContainer.id === 'blogView') {
                targetContainer.insertBefore(successMsg, targetContainer.firstChild);
            } else {
                targetContainer.appendChild(successMsg);
            }
            
            setTimeout(() => successMsg.remove(), 3000);
        }

        // Update category filter tags
        function updateCategoryTags() {
            const container = document.getElementById('categoryTags');
            const categories = [...new Set(posts.map(post => post.category))];
            
            container.innerHTML = `
                <span class="category-tag ${currentFilter === 'all' ? 'active' : ''}" onclick="filterByCategory('all')">All Posts</span>
                ${categories.map(category => `
                    <span class="category-tag ${currentFilter === category ? 'active' : ''}" onclick="filterByCategory('${category}')">${category}</span>
                `).join('')}
            `;
        }

        // Filter by category
        window.filterByCategory = function(category) {
            currentFilter = category;
            updateCategoryTags();
            displayPosts();
        };

        // Search posts
        window.searchPosts = function() {
            displayPosts();
        };

        // Initialize the blog
        initializeBlog();
    </script>
</body>
</html>